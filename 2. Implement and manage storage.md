# Implement and manage storage (15â€“20%)

## Configure access to storage

- Configure Azure Storage firewalls and virtual networks
- Create an use shared access signature (SAS) tokens
- Configure stored access policies
- Manage access keys
- Configure identity-based access for Azure Files


### Azure Storage

Azure Storage allows you to store files, messages, tables, and additional types of information in a durable, secure, scalable, managed, and accessible way. 

Azure Storage allows us to store:
- Disks and files for VMs
    - HDDs (lowest cost) or SSDs (through Premium storage)
- Unstructured data
    - Blobs (binary large object files), these are highly scalable REST-based cloud object stores
    - Data lake storage, Hadoop for example, allow us to manage file systems as a service
- Structured data
    - Tables - key value, autoscaling NoSQL stores
    - Cosmos DB is a globally distributed database service
    - Azure SQL DB
    - Additional options for relational data
        - Important: structured data is nonrelational

Azure Storage Services:
Azure Containers
- Allow us to store & manage scalable object store for unstructured text and binary data
    - Important: Blobs **cannot** be mounted.
    - We can create an unlimited number of blobs.

Azure Files
- Allow us to store & manage file shares for cloud **or** on-prem deployments
  - Directories

Azure Tables
- Allow us to use NoSQL store for schema-less storage of structured data
    - Entities
 
Azure Queues
- Allow us to manage reliable communications between application components
    - Messaging

**Important: every object stored in Azure Storage has it's own, unique URL.** 
- The storage account name will form the *subdomain* of the URL
- The subdomain & domain forms **an endpoint**; examples of each endpoint:
    - Containers: ```http://storageacctname.blob.core.windows.net```
    - Files: ```http://storageacctname.file.core.windows.net```
    - Tables: ```http://storageacctname.table.core.windows.net```
    - Queues: ```http://storageacctname.queue.core.windows.net```

Note: custom domains can be configured
    - We can purchase a domain name from a registrar.
    - Once the domain name is purchased, we will need to validate it before adding it can be used with any services.
        - Verify the domain with either a TXT record, or MX record.
    - After verifying, we can map the CNAME record to our *target* to change the endpoint to display the custom domain instead of the storage account name.


### Shared Access Signature (SAS) Tokens

These tokens provide secure and delegated access to resources in our Azure Storage account.
- Provides access to clients without requiring sharing the storage account keys.
- Provides access to Azure resources in **multiple** storage accounts.
- Delegates secured access to a resource in **only one** of the storage services.

Best practices:
- Expiry date/time
- Time zone: to align the access required for users to their time zone
- Limit the distribution of SAS tokens
- Using HTTPS instead of HTTP
- Tokens should last only for the specific time needed to follow the principle of least privilege


### Stored Access Policies

Configuring stored access policies allows us to to have an additional level of control  over *service level* SAS on the server side.

Stages of configuring stored access policies:

Create or modify stored access policy
- We can set a max of 5 access policies on a container, table, queue, or shared at any given time.
- The change, or update, of a stored access policy can take up to 30 seconds to apply before it's active.
  - Note: the SAS associated with the policy may display a 403 (Forbidden) error code.

Revoke or modify stored access policy
- To revoke, we can delete or rename the policy.
  - This can be done by modifying the signed identifier OR by changing the expiry date/time with a value in the past.


### Storage Security

The security capabilities of Azure Storage work together to allow developers to build secure apps. 

Authorization options include:
- Azure AD: Cloud-based identity & access management option which gives control over resources.
- Shared Access Signatures: allow us to delete access to a specific resource for a predetermined amount of time with specific permissions. 
- Shared keys: provides authorization & relies on access keys, along with additional params, to provide encrypted signature strings that are passed in request headers.
- Anonymouse access to containers & blobs: only use when information is **not** considered sensitive (PII).


### Storage encryption 

Azure Storage Encryption is enabled by default on **all** storage accounts.
- This includes Resource Manager & Classic Storage Accounts.

Benefits of Storage Service Encryption (SSE):
- Automatically encrypts & decrypts data using 256-bit AES encryption
- Protects data for security & compliance
- Enabled for **all** storage accounts, whether new or exisiting
- Options for managing encryption keys
    - Microsoft Managed Keys: Microsoft rotates the keys on behalf of the customer.
    - Customer Managed Keys: bring your own keys and store them in an Azure Key vault, which is a key management system (PaaS).
 




## Configure and manage storage accounts

- Create and configure storage accounts
- Configure Azure Storage redundancy
- Configure object replication
- Configure storage account encryption
- Manage data by using Azure Storage Explorer and AzCopy


## Configure Azure Files and Azure Blob Storage

- Create and configure a file share in Azure Storage
- Create and configure a container in Blob Storage
- Configure storage tiers
- Configure snapshots and soft delete for Azure Files
- Configure blob lifecycle management
- Configure blob versioning


### Immutable Storage - Blob Storage

Immutable storage for Blob Storage allows users to store business-critical data in a WORM (Write Once, Read Many) state.
- While in this state, data cannot be modified or deleted for a user specified time.
  - Important: Immutability policies protects your data from overwrites and deletes.
 
There are two types of immutability policies:
- Time-based retention policies: policies are set to store data for a specific timeframe.
  - Data can be created and read, but cannot be edited or deleted.
  - When the retention period expires, objects can be deleted but **cannot** be overwritten.
- Legal hold policies: these store the data until the legal hold is explicitly cleared.

Note: there is **no** additional cost for using immutable storage as the data is priced the same as mutable data.

[Read more on Immutable Storage for Blobs](https://learn.microsoft.com/en-us/azure/storage/blobs/immutable-storage-overview?tabs=azure-portal)
